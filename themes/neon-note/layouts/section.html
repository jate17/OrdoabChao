{{ define "main" }}
<section class="hero vstack gap-2 mb-4" aria-labelledby="section-title">
  <h1 id="section-title" class="display-6 fw-600 text-white m-0">{{ .Title }}</h1>
  {{ with .Params.description }}
    <p class="lead text-mute m-0">{{ . }}</p>
  {{ end }}
</section>

{{ with .Content }}
  <section class="mb-4">
    <div class="prose">{{ . }}</div>
  </section>
{{ end }}

{{ $p := .Paginate .Pages }}

<section class="vstack gap-3" role="list" aria-label="Elenco contenuti della sezione">
  {{ range $p.Pages }}
    <article class="card card-min h-100" role="listitem" itemscope itemtype="https://schema.org/BlogPosting">
      <a class="stretched-link text-decoration-none" href="{{ .RelPermalink }}" aria-label="Apri: {{ .Title | plainify }}">
        <div class="card-body">
          <header class="mb-2">
            <h2 class="h5 mb-1 link-quiet" itemprop="headline">{{ .LinkTitle }}</h2>
            <div class="meta small text-mute">
              {{ with .Date }}
                <time datetime='{{ . | time.Format "2006-01-02T15:04:05Z07:00" }}' itemprop="datePublished">
                  {{ . | time.Format (or $.Site.Params.dateFormat "02 Jan 2006") }}
                </time>
              {{ end }}
              {{ with .Lastmod }}
                <meta itemprop="dateModified" content='{{ . | time.Format "2006-01-02T15:04:05Z07:00" }}'>
              {{ end }}
              <meta itemprop="author" content='{{ or .Params.author $.Site.Author.name }}'>
            </div>
          </header>

          {{/* Cover opzionale: .Params.cover o prima risorsa immagine del bundle */}}
          {{ $cover := "" }}
          {{ with .Params.cover }}{{ $cover = . | relURL }}{{ end }}
          {{ if not $cover }}
            {{ with .Resources.ByType "image" }}
              {{ with .Get 0 }}{{ $cover = .RelPermalink }}{{ end }}
            {{ end }}
          {{ end }}
          {{ if $cover }}
            <figure class="mb-2">
              <img src="{{ $cover }}" alt="{{ .Title | plainify }}" loading="lazy" decoding="async" class="w-100" style="border-radius:var(--radius-sm)" itemprop="image">
            </figure>
          {{ end }}

          <p class="excerpt m-0" itemprop="description">{{ .Summary | plainify }}</p>

          {{ with .Params.tags }}
            <div class="mt-2 d-flex flex-wrap gap-2" aria-label="Tag">
              {{ range (uniq .) }}
                <a class="badge tag text-decoration-none" rel="tag" href="{{ "/tags/" | relURL }}{{ . | urlize }}">{{ . }}</a>
              {{ end }}
            </div>
          {{ end }}

          {{ if .Truncated }}
            <span class="readmore d-inline-block mt-2" aria-hidden="true">Leggi →</span>
          {{ end }}
        </div>
      </a>
      <meta itemprop="mainEntityOfPage" content="{{ .Permalink }}">
      <link itemprop="url" href="{{ .Permalink }}">
    </article>
  {{ end }}
</section>

<nav class="my-4" aria-label="Paginazione">
  <ul class="pagination justify-content-center">
    {{ if $p.HasPrev }}
      <li class="page-item">
        <a class="page-link" href="{{ $p.Prev.URL }}" rel="prev" aria-label="Pagina precedente">
          <span aria-hidden="true">&laquo;</span><span class="visually-hidden">Precedente</span>
        </a>
      </li>
    {{ else }}
      <li class="page-item disabled"><span class="page-link" aria-hidden="true">&laquo;</span></li>
    {{ end }}

    {{ range $p.Pagers }}
      <li class="page-item {{ if eq .PageNumber $p.PageNumber }}active{{ end }}">
        <a class="page-link" href="{{ .URL }}" aria-label="Vai a pagina {{ .PageNumber }}">{{ .PageNumber }}</a>
      </li>
    {{ end }}

    {{ if $p.HasNext }}
      <li class="page-item">
        <a class="page-link" href="{{ $p.Next.URL }}" rel="next" aria-label="Pagina successiva">
          <span aria-hidden="true">&raquo;</span><span class="visually-hidden">Successivo</span>
        </a>
      </li>
    {{ else }}
      <li class="page-item disabled"><span class="page-link" aria-hidden="true">&raquo;</span></li>
    {{ end }}
  </ul>
</nav>

{{/* ---------- JSON-LD: ItemList per SEO dell’elenco sezione ---------- */}}
{{ if gt (len $p.Pages) 0 }}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "ItemList",
  "itemListOrder": "http://schema.org/ItemListOrderAscending",
  "numberOfItems": {{ len $p.Pages }},
  "itemListElement": [
    {{- $last := sub (len $p.Pages) 1 -}}
    {{- range $i, $pg := $p.Pages -}}
      {
        "@type": "ListItem",
        "position": {{ add $i 1 }},
        "url": "{{ $pg.Permalink }}",
        "name": {{ $pg.Title | jsonify }}
      }{{ if lt $i $last }},{{ end }}
    {{- end -}}
  ]
}
</script>
{{ end }}

{{ end }}
